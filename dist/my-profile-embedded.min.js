!function(e){function n(o){if(a[o])return a[o].exports;var t=a[o]={exports:{},id:o,loaded:!1};return e[o].call(t.exports,t,t.exports,n),t.loaded=!0,t.exports}var a={};return n.m=e,n.c=a,n.p="/",n(0)}([function(e,n,a){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}var t=a(3),i=o(t);angular.module("gumga.myAccountEmbedded",[]).component("myAccountEmbedded",i.default)},function(e,n){"use strict";function a(e,n,a){e.myCroppedImage="",e.myImage=n,e.crop=function(e){var n=e.substring(e.indexOf(":")+1,e.indexOf(";")),o={mimeType:n,name:"profilePicture."+n.substring(n.lastIndexOf("/")+1,n.length),bytes:e.substring(e.indexOf(",")+1,e.length),size:Math.round(6*e.length/8)};a.close(o)},e.close=function(){a.close()}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=a,a.$inject=["$scope","image","$uibModalInstance"]},function(e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default='\n    <div class="modal-header modal-header-my-profile">\n      <i class="glyphicon glyphicon-remove close-crop-my-profile" ng-click="close()"></i>\n      <span>Arraste a imagem para ajustar</span>\n    </div>\n    <div class="modal-body modal-body-my-profile">\n      <div class="cropArea">\n        <img-crop image="myImage" result-image="myCroppedImage"></img-crop>\n      </div>\n    </div>\n    <div class="modal-footer modal-footer-my-profile">\n      <button class="btn btn-done-my-profile"\n              type="button"\n              ng-click="crop(myCroppedImage)">\n              <i class="glyphicon glyphicon-ok"></i>\n              </button>\n    </div>\n  '},function(e,n,a){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function t(e,n,a,o){var t,i=this;navigator.getUserMedia=navigator.getUserMedia||navigator.mediaDevices.getUserMedia||navigator.webkitGetUserMedia,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL;var r=JSON.parse(sessionStorage.getItem("user"));i.user=angular.copy(r);var s=function(){return i.configuration.defaultPicture||"resources/images/user-not-image.png"},c=function(n,a){e(function(){i.user.pictureURL="data:"+n.mimeType+";base64,"+n.bytes}),a||u()},u=function(){r.picture=i.user.picture,sessionStorage.setItem("user",JSON.stringify(r)),o.$broadcast("updateUserPicture",r),i.saveUser()};i.saveUser=function(e){a.put(i.configuration.appURL+"/api/security/update-user",{name:i.user.name,picture:i.user.picture,login:i.user.login},{headers:{gumgaToken:i.user.token}}).then(function(n){200==n.status&&e&&(o.$broadcast("myAccountUpdateUser",i.user),swal("Perfil atualizado",e,"success"))},function(){swal("Aconteceu um erro na tentativa de salvar suas atualizações, tente novamente.")})},e(function(){t=document.getElementById("my-account-file-input"),t||location.reload(),t.onchange=function(e){var n=e.srcElement||e.target;if(0!=n.files.length){var a=n.files[0];if(a){var o=new FileReader;o.readAsDataURL(a),o.onload=function(e){var n=e.target.result;i.openModalCropImage(n)}}}},i.user.picture?c(i.user.picture,!0):i.user.pictureURL=s()},1e3),i.capturePicture=function(){var e=n.open({template:d.default,controller:p.default,controllerAs:"$ctrl",backdrop:"static",size:"md",resolve:{}});e.result.then(function(e){e&&i.openModalCropImage(e)})},i.loadPicture=function(){t.click()},i.removePicture=function(){i.user.pictureURL=s(),i.user.picture=null,u()},i.openModalCropImage=function(e){var a=n.open({template:l.default,controller:g.default,controllerAs:"$ctrl",backdrop:"static",size:"md",resolve:{image:function(){return e}}});a.result.then(function(e){e&&(i.user.picture=e,c(i.user.picture))})},i.updatePassword=function(e,n,o){return e?!n||n.length<=2?void swal("Informe uma nova senha que tenha ao menos 3 digitos."):n==e?(swal("Por favor, escolha uma senha diferente da antiga."),delete i.user.newPassword,void delete i.user.confirmNewPassword):o&&o==n?void a.put(i.configuration.appURL+"/public/token",{user:i.user.login,password:e,newPassword:n}).then(function(e){"BAD_PASSWORD"==e.data.response&&(swal("A senha antiga está incorreta."),delete i.user.oldPassword),"OK"==e.data.response&&(swal("Atualizado","Sua senha foi atualizada com sucesso.","success"),delete i.user.oldPassword,delete i.user.newPassword,delete i.user.confirmNewPassword)}):(swal("Você deve repetir sua senha corretamente."),void delete i.user.confirmNewPassword):void swal("Informe sua senha atual.")},i.facialRecognition=function(){var e=n.open({template:y.default,controller:v.default,controllerAs:"$ctrl",backdrop:"static",size:"md",resolve:{config:function(){return i.configuration},user:function(){return i.user}}});e.result.then(function(e){})}}Object.defineProperty(n,"__esModule",{value:!0});var i=a(8),r=o(i),s=a(2),l=o(s),c=a(7),d=o(c),u=a(6),p=o(u),m=a(1),g=o(m),f=a(4),v=o(f),h=a(5),y=o(h);t.$inject=["$timeout","$uibModal","$http","$rootScope"],n.default={bindings:{configuration:"<?"},template:r.default,controller:t}},function(e,n){"use strict";function a(e,n,a,o,t,i){function r(){e.images=void 0,e.message="Verificando se você possui fotos...",s(i.idUser).then(function(n){e.images=[],n.data.forEach(function(n){e.images.push({id:n.id,image:"data:image/png;base64,"+n.image.bytes})}),delete e.message})}function s(e){return o.get(t.appURL+"/api/security/image-by-user/"+e+"?gumgaToken="+i.token)}function l(n,a){e.message="Salvando sua foto, aguarde...";var i=new FormData;return i.append("image",n),o({method:"POST",url:t.appURL+"/api/security/user-image?gumgaToken="+a.token,data:{imageData:n.replace("data:image/png;base64,",""),user:{id:a.idUser,login:a.login,picture:a.picture,name:a.name}}})}var c,d,u,p,m,g,f;i&&i.token||(swal("Parece que você está desconectado."),e.close()),r(),e.removeImage=function(n,a){e.message||(e.message="Removendo sua foto, aguarde...",o.get(t.appURL+"/api/security/remove-image/"+n+"?gumgaToken="+i.token).then(function(n){e.images.splice(a,1),delete e.message}))},navigator.getUserMedia({video:!0},function(n){a(function(){u=n,c=document.getElementById("video-area-my-profile"),d=document.getElementById("canvas-area-my-profile"),d.width=c.clientWidth,d.height=c.clientHeight,m=d.getContext("2d"),g={sx:0,sy:0,sWidth:d.width,sHeight:d.height},c.srcObject=n,c.play(),f=new tracking.ObjectTracker("face"),f.setInitialScale(4),f.setStepSize(2),f.setEdgesDensity(.1),tracking.stopUserMedia=function(){tracking.localStream&&tracking.localStream.stop()},p=tracking.track(c,f,{camera:!1}),e.isCapture=!1,f.on("track",function(n){m.clearRect(0,0,d.width,d.height),n.data.forEach(function(e){m.strokeStyle="#1eb7ad",m.strokeRect(e.x,e.y,e.width,e.height),m.font="12px Helvetica",m.fillStyle="#000",g.sx=e.x,g.sy=e.y,g.sWidth=e.width,g.sHeight=e.height}),e.isCapture=n.data.length>0})},500)},function(n){"PermissionDeniedError"==n.name?(swal("Você precisa permitir o acesso a sua Câmera."),e.close()):"DevicesNotFoundError"==n.name?(swal("Conecte uma câmera para tirar fotos."),e.close()):(swal("Aconteceu um erro na tentativa ligar a câmera."),e.close())});var v;e.take=function(){if(e.isCapture){var n=document.getElementById("pic-my-profile"),o=n.getContext("2d");n.width=g.sWidth,n.height=g.sHeight,o.clearRect(0,0,g.sWidth,g.sHeight),o.drawImage(c,2*g.sx,2*g.sy,2*g.sWidth,2*g.sHeight,0,0,g.sWidth,g.sHeight),v&&(a.cancel(v),v=void 0),l(n.toDataURL(),i).then(function(n){e.images.push({id:n.data.data.id,image:"data:image/png;base64,"+n.data.data.image.bytes}),a(function(){var n=document.getElementsByClassName("my-profile-images")[0];n.scrollLeft=99999999999,delete e.message},500)})}else e.messageError="Procure um lugar mais claro, não estamos conseguindo detectar seu rosto.",v=a(function(){delete e.messageError},3e3)},e.close=function(e){u&&(u.stop&&u.stop(),u.stopUserMedia&&u.stopUserMedia(),u.getVideoTracks().forEach(function(e){e.stop()})),tracking&&tracking.stopUserMedia(),p&&p.stop(),n.close(e)}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=a,a.$inject=["$scope","$uibModalInstance","$timeout","$http","config","user"]},function(e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default='\n\n    <div class="modal-header modal-header-my-profile">\n      <i class="glyphicon glyphicon-remove close-crop-my-profile" ng-click="close()"></i>\n      <span>Fotos do Reconhecimento Facial</span>\n    </div>\n    <div class="modal-body modal-body-my-profile" style="margin-bottom: -5px;height: 449px; text-align: center;">\n      <video style="border-radius: 2px;" id="video-area-my-profile" width="320" height="240" preload autoplay loop muted ></video>\n      <canvas id="canvas-area-my-profile" width="320" height="240"></canvas>\n\n      <div class="my-profile-images">\n        <label ng-show="images.length == 0 && !message" style="width: 100%;margin-top: 40px;">\n          Você não possui fotos, que tal tirar uma agora?\n        </label>\n        <div ng-repeat="image in images" class="image-item-my-profile">\n          <img class="img-circle" style="width: 100px;" ng-src="{{image.image}}" >\n          <span class="image-my-profile-placeholder" ng-click="removeImage(image.id, $index)">\n            <i class="glyphicon glyphicon-trash"></i>\n            <br>\n            Remover\n          </span>\n        </div>\n      </div>\n\n    </div>\n    <div class="modal-footer modal-footer-my-profile" style="display: flex;">\n      <label class="message-my-profile" ng-show="message">{{message}}</label>\n      <label class="message-my-profile text-danger" ng-show="messageError">{{messageError}}</label>\n      <button class="btn btn-take-my-profile"\n              ng-disabled="message"\n              type="button"\n              ng-click="take()">\n              <i class="glyphicon glyphicon-camera"></i>\n              </button>\n    </div>\n\n    <canvas id="pic-my-profile" style="display: none;"></canvas>\n\n\n    <style>\n        .message-my-profile{\n          margin: 0 auto;\n          margin-top: 35px;\n        }\n\n        .image-item-my-profile:hover > .image-my-profile-placeholder{\n          display: block;\n        }\n\n        .image-item-my-profile{\n          float: left;\n          width: 100px !important;\n          height: 100px;\n          margin-right: 10px;\n          position: relative;\n        }\n\n        .image-my-profile-placeholder{\n          position: absolute;\n          top: 0;\n          width: 100px;\n          left: 0;\n          height: 100%;\n          background: rgba(0, 0, 0, 0.57);\n          border-radius: 50%;\n          color: #fff;\n          display: none;\n          cursor: pointer;\n        }\n\n        .image-my-profile-placeholder > i {\n          color: #fff;\n          margin: 0 auto;\n          margin-top: 25px;\n          font-size: 25px;\n        }\n\n        .my-profile-images{\n            height: 145px;\n            background: #f5f5f5;\n            width: 100%;\n            padding: 15px;\n            overflow-x: scroll;\n            margin-top: 35px;\n            display: inline-flex;\n        }\n        #canvas-area-my-profile {\n            margin-left: -320px;\n        }\n         #video-area-my-profile {\n            /*box-shadow: 0px 1px 9px 0px #333131;*/\n            margin: 0 auto;\n            margin-top: 20px;\n        }\n</style>\n\n\n\n    '},function(e,n){"use strict";function a(e,n,a){var o,t,i;navigator.getUserMedia({video:!0},function(e){a(function(){i=e,o=document.getElementById("video-area-my-profile"),t=document.getElementById("canvas-area-my-profile"),o.srcObject=e,o.play()},500)},function(n){"PermissionDeniedError"==n.name?(swal("Você precisa permitir o acesso a sua Câmera."),e.close()):"DevicesNotFoundError"==n.name?(swal("Conecte uma câmera para tirar fotos."),e.close()):(swal("Aconteceu um erro na tentativa ligar a câmera."),e.close())}),e.take=function(){t.width=o.clientWidth,t.height=o.clientHeight,t.getContext("2d").drawImage(o,0,0,t.width,t.height);var n=t.toDataURL("image/png");e.close(n)},e.close=function(e){i&&(i.stop&&i.stop(),i.stopUserMedia&&i.stopUserMedia(),i.getVideoTracks().forEach(function(e){e.stop()})),n.close(e)}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=a,a.$inject=["$scope","$uibModalInstance","$timeout"]},function(e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default='\n\n    <div class="modal-header modal-header-my-profile">\n      <i class="glyphicon glyphicon-remove close-crop-my-profile" ng-click="close()"></i>\n      <span>Tirar foto</span>\n    </div>\n    <div class="modal-body modal-body-my-profile" style="margin-bottom: -5px;height: 449px;">\n      <video id="video-area-my-profile" width="100%" height="100%"></video>\n      <canvas id="canvas-area-my-profile" style="display:none;"></canvas>\n    </div>\n    <div class="modal-footer modal-footer-my-profile">\n      <button class="btn btn-take-my-profile"\n              type="button"\n              ng-click="take()">\n              <i class="glyphicon glyphicon-camera"></i>\n              </button>\n    </div>\n    '},function(e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default='\n<style>\n  my-account-embedded .form-control.gmd[disabled]{\n    background: #E4E4E4;\n  }\n  .cropArea {\n    background: #E4E4E4;\n    overflow: hidden;\n    width:100%;\n    height:350px;\n  }\n  .modal-body-my-profile{\n    padding: 0;\n  }\n  .modal-footer-my-profile{\n    background-color: #e0e0e0 !important;\n    padding: 0;\n    border: 0;\n    height: 100px;\n  }\n  .modal-header-my-profile{\n    background: #1eb7ad;\n    border: none;\n    color: #fff;\n  }\n  .modal-header-my-profile > span{\n    font-weight: 500;\n    font-size: 19px;\n    line-height: 19px;\n  }\n  .btn-done-my-profile{\n    width: 60px;\n    color: #fff !important;\n    height: 60px;\n    border-radius: 50%;\n    position: absolute;\n    outline: none !important;\n    right: 25px;\n    top: 365px;\n    font-size: 25px;\n    background: #1eb7ad;\n    padding-top: 10px;\n  }\n  .btn-take-my-profile{\n    width: 60px;\n    padding-top: 10px;\n    color: #fff !important;\n    height: 60px;\n    border-radius: 50%;\n    position: absolute;\n    outline: none !important;\n    font-size: 25px;\n    right: 25px;\n    top: 465px;\n    background: #1eb7ad;\n  }\n  .close-crop-my-profile{\n    cursor: pointer;\n  }\n</style>\n<div class="row">\n  <div class="col-xs-12">\n\n    <div class="row">\n      <div class="col-lg-2 col-sm-2 col-xs-12">\n          <div class="gmd panel panel-default">\n            <div class="panel-body">\n              <img ng-src="{{$ctrl.user.pictureURL}}" class="img-responsive img-circle"/>\n              <input id="my-account-file-input" type="file" style="display: none;" accept=".png, .jpg, .jpeg"/>\n              <div class="dropdown gmd" align="center" style="margin-top: 15px;">\n                  <button class="link gmd btn" aria-expanded="false"\n                       style="white-space: normal;font-size: 13px;overflow: hidden;"\n                       data-toggle="dropdown"\n                       aria-haspopup="true"\n                       aria-hidden="true">\n                      <i class="glyphicon glyphicon-pencil"></i>\n                      Alterar foto\n                  </button>\n                  <ul class="dropdown-menu gmd" aria-labelledby="dropdownMenu">\n                      <li ><a style="padding: 15px;cursor: pointer;" ng-click="$ctrl.capturePicture()">Tirar foto</a></li>\n                      <li ><a style="padding: 15px;cursor: pointer;" ng-click="$ctrl.loadPicture()">Carregar foto</a></li>\n                      <li ><a style="padding: 15px;cursor: pointer;" ng-click="$ctrl.removePicture()">Remover foto</a></li>\n                  </ul>\n            </div>\n            <br>\n            <button ng-show="$ctrl.configuration.facialRecognition" class="link gmd btn btn-block" style="white-space: normal;font-size: 13px;overflow: hidden;" ng-click="$ctrl.facialRecognition()">\n                <i class="glyphicon glyphicon-user"></i>\n                Reconhecimento facial\n            </button>\n          </div>\n        </div>\n      </div>\n\n      <div class="col-lg-10 col-sm-10 col-xs-12">\n\n          <div class="gmd panel panel-default">\n            <div class="panel-body">Informações</div>\n            <div class="panel-body">\n              <form>\n                <div class="row">\n                  <div class="col-sm-6">\n                    <div class="form-group">\n                      <label for="name">Nome</label>\n                      <input type="text" ng-model="$ctrl.user.name" class="gmd form-control" id="name" placeholder="Qual seu nome completo?">\n                    </div>\n                  </div>\n                  <div class="col-sm-6">\n                    <div class="form-group">\n                      <label for="email">E-mail</label>\n                      <input type="email" disabled="disabled" ng-model="$ctrl.user.login" class="gmd form-control" id="email" placeholder="Informe seu endereço de e-mail.">\n                    </div>\n                  </div>\n                </div>\n              </form>\n            </div>\n            <div class="panel-footer">\n              <button class="gmd btn btn-primary" ng-click="$ctrl.saveUser(\'Dados atualizado com sucesso.\')">Atualizar perfil</button>\n            </div>\n          </div>\n\n          <div class="gmd panel panel-default">\n            <div class="panel-body">Mudar senha</div>\n            <div class="panel-body">\n              <form>\n                <div class="row">\n                  <div class="col-sm-4">\n                    <div class="form-group">\n                      <label for="oldPassword">Senha antiga</label>\n                      <input type="password" ng-model="$ctrl.user.oldPassword" class="gmd form-control" id="oldPassword" placeholder="Qual sua senha atual?">\n                    </div>\n                  </div>\n                  <div class="col-sm-4">\n                    <div class="form-group">\n                      <label for="newPassword">Nova senha</label>\n                      <input type="password" ng-model="$ctrl.user.newPassword" class="gmd form-control" id="newPassword" placeholder="Escolha uma nova senha.">\n                    </div>\n                  </div>\n                  <div class="col-sm-4">\n                    <div class="form-group">\n                      <label for="confirmNewPassword">Confirme a nova senha</label>\n                      <input type="password" ng-model="$ctrl.user.confirmNewPassword" class="gmd form-control" id="confirmNewPassword" placeholder="Repita sua nova senha.">\n                    </div>\n                  </div>\n                </div>\n              </form>\n            </div>\n            <div class="panel-footer">\n              <button class="gmd btn btn-primary"\n                      ng-click="$ctrl.updatePassword($ctrl.user.oldPassword, $ctrl.user.newPassword, $ctrl.user.confirmNewPassword)">\n                      Atualizar senha\n              </button>\n            </div>\n          </div>\n\n      </div>\n    </div>\n\n  </div>\n</div>\n\n'}]);